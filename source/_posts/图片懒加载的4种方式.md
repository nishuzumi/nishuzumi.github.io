---
title: å›¾ç‰‡æ‡’åŠ è½½çš„4ç§æ–¹å¼
date: 2020-11-22 19:41:06
tags:
catagories:
- [å‰ç«¯]
- [JS]
- [å®ç°]
---
## å‰è¨€ ğŸ¤
ç»å…¸é—®é¢˜ï¼Œå°±ä¸ç”¨å¤šè¯´

<!--more-->
## å›¾ç‰‡
```html
<img data-src ='https://static01.imgkr.com/temp/ea80321b3be5465286bd612cb9045ac4.jpg'>
<img data-src ='https://static01.imgkr.com/temp/cb9957ec31db4fb5b3f724db8fa998dc.jpg'>
<img data-src ='https://static01.imgkr.com/temp/37247ba017db4ed6aa15b8281ad97aad.jpg'>
<img data-src ='https://static01.imgkr.com/temp/763136c2aa7e49d09d53aa15d691eb0c.jpg'>
<img data-src ='https://static01.imgkr.com/temp/5b5707a9234345d7b38d029bcd86796f.jpg'>
```

## æ–¹æ³•ä¸€ offsetTop < clientHeight + scrollTop
{% iframe https://codepen.io/nishuzumi/embed/GRqbeVy?height=265&theme-id=dark&default-tab=html,result %}
```js
//HTML
<div style='height:500px'></div>
<div>
  <img data-src ='https://static01.imgkr.com/temp/ea80321b3be5465286bd612cb9045ac4.jpg'>
  <img data-src ='https://static01.imgkr.com/temp/cb9957ec31db4fb5b3f724db8fa998dc.jpg'>
  <img data-src ='https://static01.imgkr.com/temp/37247ba017db4ed6aa15b8281ad97aad.jpg'>
  <img data-src ='https://static01.imgkr.com/temp/763136c2aa7e49d09d53aa15d691eb0c.jpg'>
  <img data-src ='https://static01.imgkr.com/temp/5b5707a9234345d7b38d029bcd86796f.jpg'>
</div>

// css
img {
  width:600px;
  height:400px;
  display:block
}

// js
function check(){
  let imgs = document.querySelectorAll('img[data-src]')
  if (imgs.length === 0) return
  let viewHeight = document.documentElement.clientHeight
  let offset = document.documentElement.scrollTop
  imgs.forEach(img=>{
    if(img.offsetTop < viewHeight + offset){
      img.src = img.dataset.src
      delete img.dataset.src
    }
  })
}

window.onscroll = check
check()

window.onscroll = check
check()
```
è¿™ä¸ªæ–¹æ³•æœ‰ä¸ªç¼ºç‚¹ï¼Œä¸èƒ½é€‚åº”å›¾ç‰‡ç»è¿‡å®šä½ï¼ˆpositionä¸ä¸ºstaticï¼‰çš„çˆ¶çº§å…ƒç´ ã€‚
## æ–¹æ³•äºŒ getBoundingClientRect().top < clientHeight
{% iframe https://codepen.io/nishuzumi/embed/PozrgGB?height=265&theme-id=dark&default-tab=html,result %}
htmlå’Œcsså†…å®¹ä¸å˜
```js
function check(){
  let imgs = document.querySelectorAll('img[data-src]')
  if (imgs.length === 0) return
  imgs.forEach(img=>{
    if (img.getBoundingClientRect().top < document.documentElement.clientHeight){
      img.src = img.dataset.src
      delete img.dataset.src
    }
  })
}

window.onscroll = check
check()
``` 
æ€§èƒ½ç¨å¾®æœ‰ç‚¹è½å

## æ–¹æ³•ä¸‰ InterscectionObserver
```js
let observe = new IntersectionObserver(
    function (entities) {
        entities.forEach(entity => {
            if(entity.intersectionRatio <= 0) return
            let img = entity.target
            img.src = img.dataset.src
            delete img.dataset.src
            observe.unobserve(img)
        })
    }, {
        threshold: 0.01
})

document.querySelectorAll('img').forEach(img => { observe.observe(img) })
```
âš ï¸æ³¨æ„ï¼Œç¬¬ä¸€æ¬¡ç›‘å¬å…ƒç´ çš„æ—¶å€™ä¼šç›´æ¥è§¦å‘ä¸€æ¬¡`callback`ï¼Œå¦‚æœæœ‰å¤šä¸ªå…ƒç´ ï¼Œåˆ™`entities`æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

## æ–¹æ³•å›› loading='lazy'
```js
<img loading='lazy' src='https://static01.imgkr.com/temp/ea80321b3be5465286bd612cb9045ac4.jpg'>
<img loading='lazy' src='https://static01.imgkr.com/temp/cb9957ec31db4fb5b3f724db8fa998dc.jpg'>
<img loading='lazy' src='https://static01.imgkr.com/temp/37247ba017db4ed6aa15b8281ad97aad.jpg'>
<img loading='lazy' src='https://static01.imgkr.com/temp/763136c2aa7e49d09d53aa15d691eb0c.jpg'>
<img loading='lazy' src='https://static01.imgkr.com/temp/5b5707a9234345d7b38d029bcd86796f.jpg'>
```
ä½¿ç”¨`loading='lazy'`çš„æ—¶å€™ï¼Œä»–çš„è¡Œä¸ºä¼šç¨å¾®æœ‰äº›æ€ªå¼‚ã€‚ä»–ä¸ä¼šç­‰åˆ°è·ç¦»è§†çª—éå¸¸è¿‘çš„æ—¶å€™æ‰åŠ è½½ï¼Œè€Œæ˜¯åœ¨æœ‰ä¸€æ®µè·ç¦»æ—¶å°±å¼€å§‹æå‰åŠ è½½ã€‚
